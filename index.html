<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Turtle Math</title>

        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300italic,700,700italic" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/milligram/1.4.1/milligram.css" />        

        <style>
            body {
                margin-top: 30px;
                padding: 0 10px;
                font-size: 16px;
            }

            .task{
                font-size: 6em
            }

            .sea {
                position: relative;
                background-color: #00dcf4;
                color: #fff;
                height: 100px;
            }
            .sprite {
                position: absolute;
            }
        </style>

        <script>
let progress = 0; // 0-100
let currentResult;
function getTask() {
    const x = Math.floor(Math.random() * 9.99) + 1;
    const y = Math.floor(Math.random() * 9.99) + 1;
    return [`${x} x ${y} =`, x * y];
}

function showTask() {
    const [question, result] = getTask();
    document.getElementById('question').innerText = question;
    document.getElementById('answer').innerText = '?';
    currentResult = result;
}
function enterResult() {
    if (parseInt(document.getElementById('answer').textContent) == currentResult) {
        progress += 5;
        showTask();
    }
    else
        progress -= 3;
    const turleX = Math.max(0, Math.min(progress, 90));
    document.getElementById('turtle').style.left = `${turleX}%`;
    document.getElementById('answer').textContent = '?';
}

function handleKeyPress(e) {
    console.log(e.code, e.key);
    if (e.code == 'Escape') {
        e.preventDefault();
        document.getElementById('answer').textContent = '?';
    }
    if (e.code == 'Backspace') {
        e.preventDefault();
        const a = document.getElementById('answer');
        const txt = a.textContent;
        if (txt.length < 2)
            a.textContent = '?';
        else
            a.textContent = txt.substr(0, txt.length - 1);
    }
    else if (e.code == 'Enter') {
        e.preventDefault();
        enterResult();
    }
    else if (e.key.charCodeAt(0) >= 48 && e.key.charCodeAt(0) <= 57) {
        const digit = e.key.charCodeAt(0) - 48;
        const a = document.getElementById('answer');
        const txt = a.textContent;
        if (txt == '?' || txt == '') {
            a.textContent = digit;
        }
        else if (txt.length == 1) {
            a.textContent = txt + digit;
        }
        else {
            a.textContent = '?';
        }
        if (parseInt(a.textContent) == currentResult)
            enterResult();
        else if (a.textContent.length == 2)
            enterResult();
        e.preventDefault();
    }
    return false;
}

window.addEventListener('DOMContentLoaded', () => {
    document.addEventListener("keydown", handleKeyPress);
    showTask();
});
        </script>
    </head>

    <body>
        <div class="sea">
            <img id="turtle" class="sprite" src="assets/turtle-licensed-opt.svg" style="width: 10%; left: 2%; top: 25%;" />
            <img id="star" class="sprite" src="assets/seastar-opt.svg" style="width: 10%; right: 50px; top: 25%;" />
        </div>
        <div class="task"><span id="question">7 x 8 =</span> <span id="answer">?</span></div>
    </body>
</html>